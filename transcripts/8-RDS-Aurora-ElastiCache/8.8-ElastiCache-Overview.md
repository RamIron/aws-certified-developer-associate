# 8.8 - ElastiCache Overview

## Key Concepts

### 1. What is ElastiCache?
- A **managed in-memory cache service** (like RDS but for caching)
- Supports **Redis** and **Memcached**
- In-memory = **high performance, low latency**
- Main purpose: **reduce read load on databases** by caching frequent queries
- Also helps **make applications stateless** (by storing session data externally)
- AWS manages: OS patching, setup, configuration, monitoring, failure recovery, backups
- **Requires application code changes** — not a "turn it on" service

### Stateful vs Stateless Applications

| | Stateful | Stateless |
|---|---|---|
| **Session data** | Stored locally on the server instance | Stored externally (e.g., ElastiCache) |
| **User redirected to another instance** | Session lost, must log in again | Session retrieved from cache, stays logged in |
| **Scaling** | Harder — need sticky sessions | Easy — any instance can serve any user |

### 2. Cache Architecture — Cache Hit vs Cache Miss

```
                 1. Query cache
        ┌──────────────────────────┐
        │                          ▼
   ┌────┴────┐              ┌─────────────┐
   │         │◄─────────────│ ElastiCache │
   │         │  2a. Cache   └─────────────┘
   │   App   │      Hit ✅        ▲
   │         │                    │ 4. Write to cache
   │         │  2b. Cache         │    (for next time)
   │         │      Miss ❌       │
   │         │              ┌─────┴───────┐
   │         │──────────────│     RDS     │
   └─────────┘  3. Query DB └─────────────┘
```

- **Cache Hit** — data found in cache, returned immediately (no DB query)
- **Cache Miss** — data not found, query DB, then write result to cache
- Need a **cache invalidation strategy** to avoid serving stale data

### 3. User Session Store

```
   User logs in
       │
       ▼
  ┌─────────┐  1. Write session  ┌─────────────┐
  │  App #1  │──────────────────►│ ElastiCache │
  └─────────┘                    └──────┬──────┘
                                        │
   User gets redirected                 │
       │                                │
       ▼                                │
  ┌─────────┐  2. Read session          │
  │  App #2  │◄─────────────────────────┘
  └─────────┘
       │
       ▼
  User is still logged in ✅
```

### 4. Redis vs Memcached

| Feature | Redis | Memcached |
|---|---|---|
| **High Availability** | Multi-AZ with auto-failover | No HA (data can be lost) |
| **Read Scaling** | Read replicas | No replicas |
| **Data Durability** | AOF persistence | No persistence |
| **Backup & Restore** | Yes | Only serverless version |
| **Data Structures** | Sets, sorted sets (leaderboards) | Simple key-value only |
| **Architecture** | Replication (primary → replica) | Sharding (data partitioned across nodes) |
| **Multi-threaded** | No | Yes |

**Exam shortcut:**
- Need HA, persistence, replicas, or sorted sets → **Redis**
- Need simple caching with multi-threaded performance, don't care about losing data → **Memcached**

---

## Exam Tips
- ElastiCache = **managed Redis or Memcached** (in-memory, high performance, low latency)
- **Requires code changes** (unlike RDS Proxy)
- Two main patterns: **DB query caching** (reduce read load) and **session store** (stateless apps)
- Cache invalidation is the hard part
- Redis = feature-rich (HA, replicas, persistence, sorted sets)
- Memcached = simple sharding, multi-threaded, no HA
- See "leaderboard" → think **Redis sorted sets**
