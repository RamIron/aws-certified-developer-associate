# 7.4 - Application Load Balancer (ALB)

## Key Concepts

### 1. ALB = Layer 7 (HTTP)
- Application Load Balancer operates at **Layer 7** (HTTP/HTTPS only)
- Supports HTTP/2, WebSocket, and automatic HTTP → HTTPS redirects
- Great for **microservices** and **container-based applications** (ECS, Docker)
- One ALB can serve **multiple applications** (unlike CLB, which needed one per app)

### 2. Routing Rules
ALB can route to different **target groups** based on:

| Route Based On   | Example                                         |
|-------------------|------------------------------------------------|
| **URL Path**      | `/users` → TG1, `/search` → TG2                |
| **Hostname**      | `one.example.com` → TG1, `other.example.com` → TG2 |
| **Query String**  | `?Platform=Mobile` → TG1, `?Platform=Desktop` → TG2 |
| **Headers**       | Custom header values → different TGs             |

### 3. Target Groups
What can sit behind an ALB:

| Target Type         | Notes                                          |
|---------------------|------------------------------------------------|
| EC2 Instances       | Can be managed by an Auto Scaling Group        |
| ECS Tasks           | Dynamic port mapping (containers)              |
| Lambda Functions    | ALB can invoke Lambda (serverless)             |
| IP Addresses        | Must be **private IPs** (e.g., on-premises servers) |

- ALB can route to **multiple target groups**
- Health checks are done at the **target group level**

### 4. Client IP: X-Forwarded-For Header

```
Client (12.34.56.78) ──► [ALB] ──► [EC2]
                          │              │
                          │  Connection  │
                          │  termination │
                          │              │
                          └──► EC2 sees ALB's private IP, NOT the client IP
                               To get the real client IP:
                               X-Forwarded-For: 12.34.56.78
                               X-Forwarded-Port: client port
                               X-Forwarded-Proto: HTTP or HTTPS
```

- ALB performs **connection termination** — it makes a new connection to EC2
- EC2 sees the **ALB's private IP** as the source, not the client's IP
- Real client info is in HTTP headers: **X-Forwarded-For**, **X-Forwarded-Port**, **X-Forwarded-Proto**

---

## Exam Tips
- ALB = Layer 7 only (HTTP/HTTPS/WebSocket)
- Routes based on: URL path, hostname, query strings, headers
- Target groups: EC2, ECS tasks, Lambda functions, private IPs
- Health checks at target group level
- Client IP → **X-Forwarded-For** header (EC2 doesn't see it directly)
- One ALB can front multiple microservices (unlike CLB: one per app)
- ALB is the go-to for microservices and containers (ECS)
- **Exam trap:** "EC2 only sees private IPs, not client IPs" → use X-Forwarded-For header
