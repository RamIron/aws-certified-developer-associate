# 7.14 - Elastic Load Balancer - Connection Draining

## Key Concepts

### 1. What is Connection Draining?
- Also called **Deregistration Delay** (on ALB/NLB)
- Gives in-flight requests **time to complete** when an instance is being deregistered or marked unhealthy
- The ELB **stops sending new requests** to the draining instance
- New connections are routed to other healthy instances

### 2. How It Works

```
                              ┌─── EC2-A (healthy) ◄── new connections go here
                              │
Users ──► [Load Balancer] ────┼─── EC2-B (DRAINING) ◄── existing connections finish,
                              │                          NO new connections
                              └─── EC2-C (healthy) ◄── new connections go here
```

- Users **already connected** to the draining instance get time to finish their requests
- **New users** are automatically routed to healthy instances only
- Once the draining period ends, all remaining connections are closed

### 3. Configuration

| Parameter | Value |
|-----------|-------|
| Range | 1 to 3,600 seconds |
| Default | **300 seconds** (5 minutes) |
| Disable | Set to **0** (no draining) |

### 4. How to Choose the Right Value
- **Short requests** (< 1 second) → set a **low value** (e.g., 30 seconds) so instances are replaced quickly
- **Long requests** (uploads, long-lived connections) → set a **high value**, but trade-off is the instance stays around longer before being taken offline

---

## Exam Tips
- Connection Draining = Deregistration Delay (same concept, different name for ALB/NLB)
- Allows in-flight requests to complete before instance is removed
- ELB stops sending **new** requests to draining instances
- Default: 300 seconds | Range: 1-3,600 | Disable: set to 0
- Low value = fast replacement | High value = long requests need time to finish
