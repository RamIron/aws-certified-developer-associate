# 7.19 - Auto Scaling Groups - Instance Refresh

## Key Concepts

### 1. What is Instance Refresh?
- A native ASG feature to **replace all EC2 instances** when you update the launch template
- Use case: you updated the **AMI** and want all running instances to use the new one
- Instead of manually terminating instances one by one, Instance Refresh automates it

### 2. How It Works

```
Old Launch Template                          New Launch Template
┌──────────────┐                             ┌──────────────┐
│ [EC2-A old]  │  ── terminate ──►           │ [EC2-D new]  │
│ [EC2-B old]  │  ── terminate ──►           │ [EC2-E new]  │
│ [EC2-C old]  │  ── terminate ──►           │ [EC2-F new]  │
└──────────────┘                             └──────────────┘

          Gradual rolling replacement
          (respects minimum healthy percentage)
```

1. You update the launch template (e.g., new AMI)
2. Call the **StartInstanceRefresh** API
3. ASG gradually terminates old instances and launches new ones
4. Continues until all instances are running the new template

### 3. Key Parameters

| Parameter | Purpose |
|-----------|---------|
| **Minimum healthy percentage** | How many instances must stay running during the refresh (e.g., 60%) |
| **Warm-up time** | How long to wait before considering a new instance ready to serve traffic. **Fixed value** — does not auto-extend |

---

## Exam Tips
- Instance Refresh = rolling replacement of all instances when launch template changes
- Triggered via the **StartInstanceRefresh** API
- **Minimum healthy percentage** controls how many instances can be replaced at a time
- **Warm-up time** ensures new instances are ready before continuing the refresh (fixed value, does not auto-extend)
- If a new instance fails health checks, the refresh **pauses** — it can't maintain the minimum healthy percentage
- This is how you roll out a new AMI across an entire ASG
